<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="layout(title, mainContent)">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:replace="${title}">Layout Title</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script>
        // Basic Tailwind Configuration (can be extended)
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                // Define primary color palette (Purple)
                'primary': {
                  '50': '#f5f3ff', '100': '#ede9fe', '200': '#ddd6fe', '300': '#c4b5fd',
                  '400': '#a78bfa', '500': '#8b5cf6', '600': '#7c3aed', '700': '#6d28d9',
                  '800': '#5b21b6', '900': '#4c1d95', '950': '#2e1065'
                },
                // Define secondary color palette (Gray)
                'secondary': {
                   '50': '#f9fafb', '100': '#f3f4f6', '200': '#e5e7eb', '300': '#d1d5db',
                   '400': '#9ca3af', '500': '#6b7280', '600': '#4b5563', '700': '#374151',
                   '800': '#1f2937', '900': '#111827', '950': '#030712'
                }
              },
              // Define font family
              fontFamily: {
                sans: ['Inter', 'sans-serif'],
              }
            }
          }
        }
    </script>
    <style>
        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif; /* Apply Inter font */
            background-color: #f8fafc; /* bg-slate-50 */
            color: #1f2937; /* text-gray-800 */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Focus ring styling for accessibility */
        *:focus-visible {
            outline: 2px solid #c4b5fd; /* primary-300 */
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(196, 181, 253, 0.5); /* primary-300 with opacity */
        }
        *:focus:not(:focus-visible) {
            outline: none; /* Remove default focus outline if not using keyboard */
        }
        /* Input field focus styling */
        input:focus, textarea:focus, select:focus {
            border-color: #a78bfa; /* primary-400 */
            box-shadow: 0 0 0 1px #a78bfa; /* primary-400 */
        }

        /* Sidebar Styling */
        .sidebar {
            background-color: #ffffff; /* bg-white */
            color: #4b5563; /* text-gray-600 */
            border-right: 1px solid #e5e7eb; /* border-gray-200 */
            transition: transform 0.3s ease-in-out;
        }
        /* Sidebar Brand/Logo */
        .sidebar .sidebar-brand {
            color: #111827; /* text-gray-900 */
            font-weight: 700;
            padding: 1.25rem 1.5rem; /* Increased padding */
            display: flex;
            align-items: center;
            gap: 0.75rem; /* Increased gap */
            border-bottom: 1px solid #f3f4f6; /* Subtle separator */
        }
        .sidebar .sidebar-brand i {
            color: #7c3aed; /* primary-600 */
            font-size: 1.25rem; /* Slightly larger icon */
        }
        /* Sidebar Navigation Links */
        .sidebar nav a {
            color: #374151; /* text-gray-700 */
            transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out, border-color 0.15s ease-in-out, transform 0.1s ease-in-out;
            border-radius: 0.5rem; /* rounded-lg */
            margin: 0.25rem 0.75rem; /* Adjusted margin */
            padding: 0.75rem 1.25rem; /* Adjusted padding */
            display: flex;
            align-items: center;
            gap: 0.875rem; /* Increased gap */
            font-weight: 500;
            border-left: 4px solid transparent; /* Increased border thickness */
        }
        /* Sidebar Link Hover State */
        .sidebar nav a:hover {
            background-color: #f5f3ff; /* primary-50 */
            color: #5b21b6; /* primary-800 */
            border-left-color: #c4b5fd; /* primary-300 */
            transform: translateX(2px); /* Subtle move effect */
        }
        /* Sidebar Link Active State */
        .sidebar nav a.active {
            background-color: #ede9fe; /* primary-100 */
            color: #6d28d9; /* primary-700 */
            font-weight: 600;
            border-left-color: #7c3aed; /* primary-600 */
        }
        .sidebar nav a.active i {
            color: #7c3aed; /* primary-600 */
        }
        /* Sidebar Link Icons */
        .sidebar nav a i {
            width: 1.25rem;
            height: 1.25rem;
            flex-shrink: 0;
            color: #9ca3af; /* text-gray-400 */
            transition: color 0.15s ease-in-out;
        }
        .sidebar nav a:hover i {
            color: #5b21b6; /* primary-800 */
        }
        /* Sidebar Navigation Section Titles */
        .sidebar .nav-title {
            color: #9ca3af; /* text-gray-400 */
            font-size: 0.75rem; /* text-xs */
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.075em;
            padding: 1.75rem 1rem 0.75rem 1.5rem; /* Adjusted padding */
        }
        /* Sidebar Logout Button */
        .sidebar .logout-button {
            background-color: #f9fafb; /* bg-gray-50 */
            color: #4b5563; /* text-gray-600 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            font-weight: 500;
            border-radius: 0.5rem; /* rounded-lg */
            transition: all 0.15s ease-in-out;
        }
        .sidebar .logout-button:hover {
            background-color: #fef2f2; /* bg-red-50 */
            color: #b91c1c; /* text-red-700 */
            border-color: #fecaca; /* border-red-200 */
        }

        /* Top Navigation Bar Styling */
        .top-nav {
            background-color: #ffffff; /* bg-white */
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
            box-shadow: 0 1px 3px rgba(0,0,0,0.04); /* Slightly increased shadow */
            padding: 0.75rem 0; /* Adjusted padding */
            position: sticky;
            top: 0;
            z-index: 40;
        }
        /* Top Nav Profile Link Area */
        .top-nav .profile-link {
            /* padding: 0.375rem; */ /* Removed padding here */
            border-radius: 9999px; /* rounded-full */
            transition: background-color 0.15s ease-in-out;
            display: flex;
            align-items: center;
            /* Add hover effect to the whole link area if desired */
            /* padding: 0.25rem; */
            /* &:hover { background-color: #f3f4f6; } */
        }
        /* Top Nav Profile Image/Placeholder Container */
        .top-nav .profile-image-container {
            width: 2.5rem; /* w-10 */
            height: 2.5rem; /* h-10 */
            border-radius: 9999px; /* rounded-full */
            overflow: hidden; /* Clip image to circle */
            border: 2px solid #e5e7eb; /* border-gray-200 */
            flex-shrink: 0; /* Prevent shrinking */
            background-color: #e5e7eb; /* Placeholder bg */
            display: flex; /* For placeholder icon */
            align-items: center;
            justify-content: center;
        }
        /* Top Nav Profile Image */
        .top-nav .profile-link img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Prevent distortion */
            display: block; /* Remove extra space */
        }
        /* Top Nav Placeholder Icon */
        .top-nav .profile-link .profile-placeholder-icon {
            color: #9ca3af; /* text-gray-400 */
            font-size: 1.125rem; /* text-lg */
        }
        /* Top Nav Username/Role Text */
        .top-nav .profile-link .username-text {
            color: #374151; /* text-gray-700 */
            font-weight: 500;
            line-height: 1.25; /* Added line-height */
        }
        .top-nav .profile-link .role-text {
            color: #6d28d9; /* primary-700 */
            font-weight: 500;
            font-size: 0.75rem; /* text-xs */
            line-height: 1.25; /* Added line-height */
        }

        /* Main Content Area Styling */
        main {
            background-color: #f8fafc; /* bg-slate-50 */
        }
        .main-container {
            padding: 1.5rem; /* Default padding */
        }
        @media (min-width: 768px) { .main-container { padding: 2rem; } } /* md */
        @media (min-width: 1024px) { .main-container { padding: 2.5rem; } } /* lg */

        /* Footer Styling */
        footer.page-footer {
            background-color: #ffffff; /* bg-white */
            border-top: 1px solid #e5e7eb; /* border-gray-200 */
            color: #6b7280; /* text-gray-500 */
            padding: 1.25rem; /* Increased padding */
            text-align: center;
            font-size: 0.875rem; /* text-sm */
        }

        /* Form Element Base Styling */
        input[type="text"], input[type="email"], input[type="password"], input[type="datetime-local"], input[type="number"], textarea, select {
            background-color: #ffffff; /* bg-white */
            border-color: #d1d5db; /* border-gray-300 */
            color: #374151; /* text-gray-700 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.625rem 0.875rem; /* Adjusted padding */
            border-width: 1px;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            font-size: 0.875rem; /* text-sm */
        }
        label {
            color: #374151; /* text-gray-700 */
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            margin-bottom: 0.375rem; /* Increased margin */
            display: block;
        }

        /* Button Base Styling */
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            font-weight: 600;
            padding: 0.625rem 1.25rem; /* Base padding */
            border-radius: 0.5rem; /* rounded-lg */
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid transparent;
            text-align: center;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.06), 0 1px 2px 0 rgba(0, 0, 0, 0.03); /* Adjusted shadow */
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04); /* Adjusted hover shadow */
        }
        .btn:active {
            transform: translateY(0px);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.06), 0 1px 2px 0 rgba(0, 0, 0, 0.03);
        }
        /* Button Color Variants */
        .btn-primary { background-color: #7c3aed; color: white; border-color: #7c3aed; } .btn-primary:hover { background-color: #6d28d9; }
        .btn-secondary { background-color: #ffffff; color: #374151; border-color: #d1d5db; } .btn-secondary:hover { background-color: #f9fafb; }
        .btn-danger { background-color: #ef4444; color: white; border-color: #ef4444; } .btn-danger:hover { background-color: #dc2626; }
        .btn-success { background-color: #10b981; color: white; border-color: #10b981; } .btn-success:hover { background-color: #059669; }
        .btn-warning { background-color: #f59e0b; color: #1f2937; border-color: #f59e0b; } .btn-warning:hover { background-color: #d97706; }
        /* Button Size Variants */
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; } .btn-lg { padding: 0.75rem 1.5rem; font-size: 1.125rem; }

        /* Alert Styling */
        .alert { padding: 1rem; margin-bottom: 1.5rem; border-radius: 0.5rem; border-width: 1px; font-size: 0.875rem; }
        .alert-success { background-color: #f0fdf4; border-color: #a7f3d0; color: #065f46; } /* Adjusted colors */
        .alert-danger { background-color: #fef2f2; border-color: #fecaca; color: #991b1b; }
        .alert-info { background-color: #eff6ff; border-color: #bfdbfe; color: #1e40af; }
        .alert-warning { background-color: #fffbeb; border-color: #fde68a; color: #92400e; }

        /* Table Styling */
        table { border-collapse: separate; border-spacing: 0; width: 100%; }
        th, td { padding: 0.875rem 1rem; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: middle; }
        th { background-color: #f9fafb; color: #4b5563; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        tbody tr:hover { background-color: #f9fafb; }
        .table-container { overflow-x: auto; border: 1px solid #e5e7eb; border-radius: 0.75rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.03); }

        /* Preformatted Text (Code Blocks/Feedback) */
        pre { background-color: #f3f4f6; color: #1f2937; padding: 0.75rem 1rem; border-radius: 0.5rem; white-space: pre-wrap; word-wrap: break-word; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 0.875rem; border: 1px solid #e5e7eb; }
        .feedback-block pre { background-color: #f0fdf4; border-color: #a7f3d0; color: #14532d; } /* Specific style for feedback */

        /* Badge Styling */
        .badge { display: inline-block; padding: 0.125rem 0.625rem; font-size: 0.75rem; font-weight: 500; border-radius: 9999px; line-height: 1.25; }
        .badge-green { background-color: #d1fae5; color: #065f46; } /* Example badge colors */
        .badge-red { background-color: #fee2e2; color: #991b1b; }
        .badge-blue { background-color: #dbeafe; color: #1e40af; }
        .badge-indigo { background-color: #e0e7ff; color: #3730a3; }

        /* Action Icon Styling (used in tables/lists) */
        .action-icon { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem; border-radius: 0.375rem; transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out; text-decoration: none; border: none; background-color: transparent; cursor: pointer; }
        .action-icon:hover { background-color: #f3f4f6; text-decoration: none; }
        .action-icon i { width: 1rem; height: 1rem; margin: 0; }
        .action-icon span { font-size: 0.75rem; font-weight: 500; margin-left: 0.25rem; }

        /* --- START: Chat Box Styling (v4 - Sticky Header/Footer) --- */

        /* Chat Box Container (The scrollable part) */
        /* Applied to #chat-box in student/class-details.html */
        #chat-box {
            flex-grow: 1; /* Allow this area to grow and fill space */
            overflow-y: auto; /* Make ONLY this part scrollable */
            border: none; /* Remove border if parent card has one */
            padding: 1rem;
            background-color: #f9fafb; /* bg-gray-50 */
            /* REMOVED border-radius, margin-bottom */
            display: flex;
            flex-direction: column; /* Keep messages stacking normally */
            scroll-behavior: smooth;
        }
        /* Scrollbar Styling */
        #chat-box::-webkit-scrollbar { width: 8px; }
        #chat-box::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        #chat-box::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        #chat-box::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        /* Message List within Chat Box */
        #message-list {
             display: flex;
             flex-direction: column; /* Stack messages vertically */
             gap: 0.75rem; /* Space between message rows */
             /* REMOVED: padding-top: 0.5rem; */
             padding-bottom: 0.5rem; /* Add padding at the bottom */
             margin-top: auto; /* Push messages to bottom when few */
        }

        /* Individual Message Row (Avatar + Bubble) */
        .message-row {
            display: flex;
            align-items: flex-end; /* Align avatar bottom with bubble */
            gap: 0.75rem; /* Space between avatar and bubble */
            max-width: 85%; /* Prevent row from taking full width */
        }
        /* Align own messages to the right */
        .message-row.my-message-row {
            margin-left: auto; /* Push to the right */
            flex-direction: row-reverse; /* Avatar on the right */
        }
        /* Align other messages to the left */
        .message-row.other-message-row {
            margin-right: auto; /* Push to the left */
        }

        /* Avatar Styling (Ensure rounded) */
        .message-avatar {
            width: 2.5rem; /* w-10 */
            height: 2.5rem; /* h-10 */
            border-radius: 9999px; /* rounded-full */
            flex-shrink: 0; /* Prevent avatar from shrinking */
            overflow: hidden; /* Crucial for rounded image */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            background-color: #e5e7eb; /* Placeholder bg */
            display: flex; /* For placeholder icon */
            align-items: center;
            justify-content: center;
            color: #9ca3af; /* Placeholder icon color */
        }
        /* Style the IMG tag inside the avatar div */
        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the area */
            display: block; /* Remove extra space below image */
        }
        .message-avatar i { /* Placeholder icon size */
            font-size: 1.125rem;
        }

        /* Message Bubble Container */
        .message-bubble {
            padding: 0.6rem 1rem; /* Adjusted padding */
            border-radius: 1rem; /* Rounded bubble */
            word-wrap: break-word;
            line-height: 1.5;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border: 1px solid transparent;
        }

        /* My Message Bubble */
        .my-message-row .message-bubble {
            background-color: #8b5cf6; /* primary-500 */
            color: #ffffff;
            border-color: #7c3aed; /* primary-600 */
            border-bottom-right-radius: 0.25rem; /* Flatten corner */
        }
        /* Other Message Bubble */
        .other-message-row .message-bubble {
            background-color: #ffffff;
            color: #1f2937;
            border-color: #e5e7eb;
            border-bottom-left-radius: 0.25rem; /* Flatten corner */
        }

        /* Sender Details within Bubble */
        .message-sender-details {
            margin-bottom: 0.25rem;
        }
        .sender-name {
            font-weight: 600;
            font-size: 0.8rem; /* Slightly smaller name */
        }
        .my-message-row .sender-name {
             color: #ede9fe; /* Lighter name on dark bg */
        }
        .other-message-row .sender-name {
             color: #6d28d9; /* Purple name on light bg */
        }
        .sender-info { /* For Role/ID */
            font-size: 0.7rem; /* Tiny info */
            margin-left: 0.5rem;
            opacity: 0.8;
        }
        .my-message-row .sender-info { color: #ddd6fe; }
        .other-message-row .sender-info { color: #6b7280; }

        /* Message Content */
        .message-content {
            font-size: 0.9rem;
        }
        .my-message-row .message-content { color: #ffffff; }
        .other-message-row .message-content { color: #1f2937; }

        /* System Messages (Join/Leave/Status) */
        .system-message, #chat-status {
            text-align: center;
            color: #6b7280; /* text-gray-500 */
            font-size: 0.75rem; /* text-xs */
            padding: 0.25rem;
            font-style: italic;
            margin: 0.5rem 0;
            width: 100%; /* Make system messages span width */
        }
        .system-message.error, #chat-status.error {
            color: #b91c1c; /* text-red-700 */
            font-weight: 500;
            font-style: normal;
        }
        /* --- END: Chat Box Styling (v4) --- */

        /* General Content Card Styling */
        .content-card {
            @apply bg-white p-5 sm:p-6 rounded-lg shadow-sm border border-gray-200; /* Consistent card style */
        }

    </style>
</head>
<body class="flex h-screen bg-slate-50 text-gray-800">
    <aside class="sidebar z-20 hidden w-64 overflow-y-auto bg-white md:block flex-shrink-0 border-r border-gray-200">
        <div class="py-4 text-gray-500">
            <a class="sidebar-brand text-lg" th:href="@{/dashboard}">
                <i class="fas fa-graduation-cap"></i> <span>Student Mgmt</span>
            </a>
            <nav class="mt-4">
                <ul class="space-y-1 px-2">
                    <li sec:authorize="hasAnyRole('ADMIN', 'TEACHER', 'STUDENT')">
                        <a th:href="@{/dashboard}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/dashboard')) ? 'active' : ''}">
                            <i class="fas fa-tachometer-alt fa-fw"></i><span>Dashboard</span>
                        </a>
                    </li>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/messages}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/messages')) ? 'active' : ''}">
                            <i class="fas fa-comments fa-fw"></i><span>Messages</span>
                        </a>
                    </li>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/friends}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/friends')) ? 'active' : ''}">
                            <i class="fas fa-users fa-fw"></i><span>Friends</span>
                        </a>
                    </li>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/settings}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/settings')) ? 'active' : ''}">
                            <i class="fas fa-cog fa-fw"></i><span>Settings</span>
                        </a>
                    </li>
                </ul>
                <ul class="mt-4 space-y-1 px-2">
                    <li class="nav-title" sec:authorize="hasRole('ADMIN')">Admin</li>
                    <li sec:authorize="hasRole('ADMIN')">
                        <a th:href="@{/admin/teachers}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/admin/teachers')) ? 'active' : ''}">
                            <i class="fas fa-chalkboard-teacher fa-fw"></i><span>Manage Teachers</span>
                        </a>
                    </li>
                    <li class="nav-title" sec:authorize="hasRole('TEACHER')">Teacher</li>
                    <li sec:authorize="hasRole('TEACHER')">
                        <a th:href="@{/teacher/classes}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and (#httpServletRequest.requestURI.startsWith('/teacher/classes') or #httpServletRequest.requestURI.startsWith('/teacher/assignments') or #httpServletRequest.requestURI.startsWith('/teacher/quizzes') or #httpServletRequest.requestURI.startsWith('/teacher/attempts'))) ? 'active' : ''}">
                            <i class="fas fa-school fa-fw"></i><span>My Classes</span>
                        </a>
                    </li>
                     <li sec:authorize="hasRole('TEACHER')">
                        <a th:href="@{/teacher/makeup-requests}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/teacher/makeup-requests')) ? 'active' : ''}">
                            <i class="fas fa-history fa-fw"></i><span>Makeup Requests</span>
                        </a>
                    </li>
                    <li class="nav-title" sec:authorize="hasRole('STUDENT')">Student</li>
                    <li sec:authorize="hasRole('STUDENT')">
                        <a th:href="@{/student/classes}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/student/classes')) ? 'active' : ''}">
                            <i class="fas fa-graduation-cap fa-fw"></i><span>My Classes</span>
                        </a>
                    </li>
                    <li sec:authorize="hasRole('STUDENT')">
                        <a th:href="@{/student/assignments}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and (#httpServletRequest.requestURI.startsWith('/student/assignments') or #httpServletRequest.requestURI.startsWith('/student/submit') or #httpServletRequest.requestURI.startsWith('/student/makeup'))) ? 'active' : ''}">
                            <i class="fas fa-book-open fa-fw"></i><span>Assignments</span>
                        </a>
                    </li>
                    <li sec:authorize="hasRole('STUDENT')">
                        <a th:href="@{/student/quizzes}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/student/quizzes')) ? 'active' : ''}">
                            <i class="fas fa-question-circle fa-fw"></i><span>Quizzes</span>
                        </a>
                    </li>
                    <li sec:authorize="hasRole('STUDENT')">
                        <a th:href="@{/student/classes/join}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/student/classes/join')) ? 'active' : ''}">
                            <i class="fas fa-plus-circle fa-fw"></i><span>Join Class</span>
                        </a>
                    </li>
                    <li sec:authorize="!isAuthenticated()">
                        <a th:href="@{/login}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/login')) ? 'active' : ''}">
                            <i class="fas fa-sign-in-alt fa-fw"></i><span>Login</span>
                        </a>
                    </li>
                     <li sec:authorize="!isAuthenticated()">
                        <a th:href="@{/register}" th:classappend="${(#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/register')) ? 'active' : ''}">
                            <i class="fas fa-user-plus fa-fw"></i><span>Register</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="px-4 my-8" sec:authorize="isAuthenticated()">
                <form th:action="@{/logout}" method="post">
                    <button type="submit" class="logout-button flex items-center justify-center w-full px-4 py-2 text-sm leading-5 transition-colors duration-150 border rounded-lg focus:outline-none focus:shadow-outline-gray">
                        <i class="fas fa-sign-out-alt mr-2 -ml-1 w-4 h-4"></i>
                        Logout
                    </button>
                </form>
            </div>
        </div>
    </aside>

    <div class="flex flex-col flex-1 w-full">
        <header class="top-nav z-40">
             <div class="container mx-auto flex items-center justify-between h-full px-6">
                <button class="p-1 -ml-1 mr-5 rounded-md md:hidden focus:outline-none text-gray-500 hover:text-purple-600" aria-label="Menu" id="mobileMenuButton">
                    <i class="fas fa-bars w-6 h-6"></i>
                </button>
                <div class="flex-1"></div> <ul class="flex items-center flex-shrink-0 space-x-4">
                    <li class="relative" sec:authorize="isAuthenticated()">
                        <a th:href="@{/profile/{username}(username=${#authentication.name})}" class="profile-link hover:no-underline" aria-label="Account">
                            <div class="profile-image-container">
                                <img th:if="${loggedInUser != null && loggedInUser.profilePicturePath != null}"
                                     th:src="@{/download/profile/{filename}(filename=${loggedInUser.profilePicturePath})}"
                                     alt="User avatar"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                     />
                                <span th:if="${loggedInUser == null || loggedInUser.profilePicturePath == null}"
                                      class="profile-placeholder-icon">
                                      <i class="fas fa-user"></i>
                                </span>
                            </div>
                            <div class="ml-3 hidden sm:block">
                                <span class="block text-sm username-text">
                                    <span th:if="${loggedInUser != null}" th:text="${loggedInUser.firstName + ' ' + loggedInUser.lastName}">User Name</span>
                                    <span th:if="${loggedInUser == null}" sec:authentication="name">Username</span>
                                </span>
                                <th:block th:if="${loggedInUser != null and !loggedInUser.roles.isEmpty()}">
                                    <span class="block text-xs role-text capitalize" th:text="${#strings.replace(loggedInUser.roles.iterator().next().name, 'ROLE_', '').toLowerCase()}">(role)</span>
                                </th:block>
                            </div>
                        </a>
                    </li>
                    <li sec:authorize="!isAuthenticated()">
                        <a th:href="@{/login}" class="text-sm font-medium text-gray-600 hover:text-purple-600">Login</a>
                    </li>
                </ul>
            </div>
        </header>

        <main class="h-full overflow-y-auto flex-1">
            <div class="container mx-auto main-container" th:replace="${mainContent}">
                <p>Welcome to the Student Management System.</p>
            </div>
        </main>

        
    </div>

     <script>
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const sidebar = document.querySelector('.sidebar');
        if (mobileMenuButton && sidebar) {
            mobileMenuButton.addEventListener('click', () => {
                sidebar.classList.toggle('hidden'); // Toggle visibility for mobile
                // Optional: Add overlay or other effects
            });
        }
    </script>

</body>
</html>
